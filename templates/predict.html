{% extends "base.html" %}

{% block title %}Car Price Prediction - Predict{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">
            <i class="fas fa-calculator text-blue-600 mr-3"></i>Car Price Prediction
        </h1>
        <p class="text-gray-600 text-lg">Enter your car details to get an accurate price prediction</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
        <!-- Prediction Form -->
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-car mr-2 text-green-600"></i>Car Details
            </h2>

            <form method="POST" class="space-y-6">
                <!-- Year -->
                <div>
                    <label for="year" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt mr-2"></i>Year of Manufacture
                    </label>
                    <input type="number" 
                           id="year" 
                           name="year" 
                           min="1990" 
                           max="2024" 
                           required 
                           value="{{ form_data.year if form_data else '2020' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 2020">
                    <p class="text-xs text-gray-500 mt-1">Enter year between 1990-2024</p>
                </div>

                <!-- Engine Size -->
                <div>
                    <label for="engine_size" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-cog mr-2"></i>Engine Size (Liters)
                    </label>
                    <input type="number" 
                           id="engine_size" 
                           name="engine_size" 
                           step="0.1" 
                           min="0.5" 
                           max="8.0" 
                           required 
                           value="{{ form_data.engine_size if form_data else '1.5' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 1.5">
                    <p class="text-xs text-gray-500 mt-1">Engine displacement in liters</p>
                </div>

                <!-- Annual Tax -->
                <div>
                    <label for="tax" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-dollar-sign mr-2"></i>Annual Tax ($)
                    </label>
                    <input type="number" 
                           id="tax" 
                           name="tax" 
                           min="0" 
                           max="1000" 
                           required 
                           value="{{ form_data.tax if form_data else '150' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 150">
                    <p class="text-xs text-gray-500 mt-1">Annual vehicle tax amount</p>
                </div>

                <!-- Model Type -->
                <div>
                    <label for="model" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-car-side mr-2"></i>Car Model Type
                    </label>
                    <select id="model" 
                            name="model" 
                            required 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Model Type</option>
                        <option value="1" {{ 'selected' if form_data and form_data.model == '1' else '' }}>Compact Car (1)</option>
                        <option value="2" {{ 'selected' if form_data and form_data.model == '2' else '' }}>Sedan (2)</option>
                        <option value="3" {{ 'selected' if form_data and form_data.model == '3' else '' }}>SUV (3)</option>
                        <option value="4" {{ 'selected' if form_data and form_data.model == '4' else '' }}>Hatchback (4)</option>
                        <option value="5" {{ 'selected' if form_data and form_data.model == '5' else '' }}>Fiesta (5)</option>
                        <option value="6" {{ 'selected' if form_data and form_data.model == '6' else '' }}>Focus (6)</option>
                        <option value="7" {{ 'selected' if form_data and form_data.model == '7' else '' }}>Other (7)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Select the closest model type</p>
                </div>

                <!-- Mileage -->
                <div>
                    <label for="mileage" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-road mr-2"></i>Mileage (Miles)
                    </label>
                    <input type="number" 
                           id="mileage" 
                           name="mileage" 
                           min="0" 
                           max="500000" 
                           required 
                           value="{{ form_data.mileage if form_data else '12000' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 12000">
                    <p class="text-xs text-gray-500 mt-1">Total miles driven</p>
                </div>

                <!-- MPG -->
                <div>
                    <label for="mpg" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-gas-pump mr-2"></i>Fuel Efficiency (MPG)
                    </label>
                    <input type="number" 
                           id="mpg" 
                           name="mpg" 
                           step="0.1" 
                           min="10" 
                           max="100" 
                           required 
                           value="{{ form_data.mpg if form_data else '50.0' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="e.g., 50.0">
                    <p class="text-xs text-gray-500 mt-1">Miles per gallon</p>
                </div>

                <!-- Transmission -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-cogs mr-2"></i>Transmission Type
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" 
                                   name="transmission_manual" 
                                   value="1" 
                                   {{ 'checked' if form_data and form_data.transmission_manual == '1' else 'checked' }}
                                   class="mr-3">
                            <div>
                                <div class="font-medium">Manual</div>
                                <div class="text-sm text-gray-500">Stick shift</div>
                            </div>
                        </label>
                        <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" 
                                   name="transmission_manual" 
                                   value="0" 
                                   {{ 'checked' if form_data and form_data.transmission_manual == '0' else '' }}
                                   class="mr-3">
                            <div>
                                <div class="font-medium">Automatic</div>
                                <div class="text-sm text-gray-500">Auto/Semi-auto</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition duration-200 text-lg">
                    <i class="fas fa-calculator mr-2"></i>Predict Car Price
                </button>
            </form>
        </div>

        <!-- Prediction Result -->
        <div class="space-y-6">
            {% if predicted_price %}
            <!-- Prediction Result Card -->
            <div class="bg-gradient-to-r from-green-500 to-blue-600 text-white p-8 rounded-lg shadow-lg">
                <div class="text-center">
                    <i class="fas fa-check-circle text-4xl mb-4"></i>
                    <h3 class="text-2xl font-bold mb-2">Prediction Complete!</h3>
                    <div class="text-5xl font-bold mb-4">
                        ${{ "{:,.2f}".format(predicted_price) }}
                    </div>
                    <p class="text-green-100">Estimated market value for your car</p>
                </div>
            </div>

            <!-- Car Summary -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>Car Summary
                </h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-gray-600">Year:</span>
                        <span class="font-medium ml-2">{{ form_data.year }}</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Engine:</span>
                        <span class="font-medium ml-2">{{ form_data.engine_size }}L</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Mileage:</span>
                        <span class="font-medium ml-2">{{ "{:,}".format(form_data.mileage|int) }} miles</span>
                    </div>
                    <div>
                        <span class="text-gray-600">MPG:</span>
                        <span class="font-medium ml-2">{{ form_data.mpg }}</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Tax:</span>
                        <span class="font-medium ml-2">${{ form_data.tax }}</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Transmission:</span>
                        <span class="font-medium ml-2">
                            {% if form_data.transmission_manual == '1' %}Manual{% else %}Automatic{% endif %}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tools mr-2 text-purple-600"></i>What's Next?
                </h3>
                <div class="space-y-3">
                    <button onclick="savePrediction()" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                        <i class="fas fa-save mr-2"></i>Save This Prediction
                    </button>
                    <button onclick="shareResult()" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                        <i class="fas fa-share mr-2"></i>Share Result
                    </button>
                    <a href="{{ url_for('predict') }}" 
                       class="block w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded text-center">
                        <i class="fas fa-plus mr-2"></i>New Prediction
                    </a>
                </div>
            </div>
            {% else %}
            <!-- Information Card -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-lightbulb mr-2 text-yellow-600"></i>How It Works
                </h3>
                <div class="space-y-3 text-sm text-gray-600">
                    <div class="flex items-start">
                        <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                        <span>Our AI model analyzes 7 key car features</span>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                        <span>Trained on thousands of real car sales data</span>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                        <span>CatBoost algorithm for high accuracy</span>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check text-green-500 mr-3 mt-1"></i>
                        <span>Instant results in seconds</span>
                    </div>
                </div>
            </div>

            <!-- Tips Card -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tips mr-2 text-blue-600"></i>Tips for Accuracy
                </h3>
                <div class="space-y-2 text-sm text-gray-600">
                    <p><strong>Year:</strong> More recent years typically have higher values</p>
                    <p><strong>Mileage:</strong> Lower mileage generally increases value</p>
                    <p><strong>Engine Size:</strong> Larger engines may increase or decrease value depending on market</p>
                    <p><strong>MPG:</strong> Higher fuel efficiency often increases value</p>
                    <p><strong>Transmission:</strong> Manual vs automatic preference varies by market</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function savePrediction() {
    // In a real app, this would save to favorites or bookmarks
    alert('Prediction saved to your dashboard!');
}

function shareResult() {
    // In a real app, this would generate a shareable link
    const result = "I just predicted my car's value at ${{ predicted_price if predicted_price else '0' }} using the Car Price Prediction System!";
    
    if (navigator.share) {
        navigator.share({
            title: 'Car Price Prediction Result',
            text: result,
            url: window.location.href
        });
    } else {
        // Fallback for browsers that don't support Web Share API
        navigator.clipboard.writeText(result + ' ' + window.location.href).then(() => {
            alert('Result copied to clipboard!');
        });
    }
}

// Form validation and UX improvements
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input[type="number"]');
    
    // Add real-time validation feedback
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const min = parseFloat(this.min);
            const max = parseFloat(this.max);
            
            if (value < min || value > max) {
                this.classList.add('border-red-500');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-gray-300');
            }
        });
    });
    
    // Add loading state to submit button
    form.addEventListener('submit', function() {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Predicting...';
        submitBtn.disabled = true;
    });
});
</script>
{% endblock %}