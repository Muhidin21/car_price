{% extends "base.html" %}

{% block title %}Email Verification - Car Price Prediction{% endblock %}

{% block content %}
<div class="min-h-[calc(100vh-12rem)] flex items-center justify-center py-8">
    <div class="w-full max-w-md">
        <div class="card-gradient rounded-xl shadow-glow p-6 sm:p-8 border border-gray-200">
            <div class="text-center mb-6">
                <div class="bg-gradient-to-br from-blue-500 to-green-600 w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-glow">
                    <i class="fas fa-envelope-open text-white text-2xl sm:text-3xl"></i>
                </div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Verify Your Email</h2>
                <p class="text-gray-600 text-sm sm:text-base">We've sent a verification code to</p>
                <p class="text-blue-600 font-semibold text-sm sm:text-base">{{ email }}</p>
            </div>

            <form method="POST" class="space-y-4 sm:space-y-6">
                <div>
                    <label for="otp" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-key mr-2 text-blue-600"></i>Verification Code
                    </label>
                    <input type="text" 
                           id="otp" 
                           name="otp" 
                           required 
                           maxlength="6"
                           pattern="[0-9]{6}"
                           class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-2xl font-mono tracking-widest transition-all duration-300 hover:border-blue-400"
                           placeholder="000000"
                           autocomplete="one-time-code">
                    <p class="text-xs text-gray-500 mt-1">Enter the 6-digit code from your email</p>
                </div>

                <button type="submit" 
                        class="w-full button-gradient text-white py-2.5 sm:py-3 px-6 rounded-lg font-semibold hover:shadow-glow transition-all duration-300 text-base sm:text-lg">
                    <i class="fas fa-check mr-2"></i>Verify Email
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-gray-600 text-sm sm:text-base mb-3">Didn't receive the code?</p>
                <button onclick="resendOTP()" 
                        id="resendBtn"
                        class="text-blue-600 hover:text-blue-800 font-semibold text-sm transition-colors">
                    <i class="fas fa-redo mr-1"></i>Resend Code
                </button>
                <div id="countdown" class="text-gray-500 text-sm mt-2"></div>
            </div>

            <!-- Information Card -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h3 class="text-sm font-semibold text-gray-800 mb-2">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>Important Notes
                </h3>
                <ul class="text-xs text-gray-600 space-y-1">
                    <li><i class="fas fa-clock mr-2"></i>Code expires in 40 minutes</li>
                    <li><i class="fas fa-shield-alt mr-2"></i>Check your spam folder if not received</li>
                    <li><i class="fas fa-envelope mr-2"></i>Only the latest code is valid</li>
                </ul>
            </div>

            <div class="mt-6 text-center">
                <a href="{{ url_for('register') }}" class="text-blue-600 hover:text-blue-800 text-sm transition-colors">
                    <i class="fas fa-arrow-left mr-1"></i>Back to Registration
                </a>
            </div>
        </div>
    </div>
</div>

<script>
let resendCooldown = 0;

function resendOTP() {
    if (resendCooldown > 0) {
        return;
    }
    
    const resendBtn = document.getElementById('resendBtn');
    resendBtn.disabled = true;
    resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Sending...';
    
    fetch('/resend_otp', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('✅ ' + data.message);
            startCooldown();
        } else {
            alert('❌ ' + data.message);
            resendBtn.disabled = false;
            resendBtn.innerHTML = '<i class="fas fa-redo mr-1"></i>Resend Code';
        }
    })
    .catch(error => {
        alert('❌ Error sending code. Please try again.');
        resendBtn.disabled = false;
        resendBtn.innerHTML = '<i class="fas fa-redo mr-1"></i>Resend Code';
    });
}

function startCooldown() {
    resendCooldown = 60;
    const countdownEl = document.getElementById('countdown');
    const resendBtn = document.getElementById('resendBtn');
    
    const timer = setInterval(() => {
        resendCooldown--;
        countdownEl.textContent = `Resend available in ${resendCooldown} seconds`;
        
        if (resendCooldown <= 0) {
            clearInterval(timer);
            countdownEl.textContent = '';
            resendBtn.disabled = false;
            resendBtn.innerHTML = '<i class="fas fa-redo mr-1"></i>Resend Code';
        }
    }, 1000);
}
</script>
{% endblock %}